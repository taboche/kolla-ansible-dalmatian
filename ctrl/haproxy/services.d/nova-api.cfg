frontend nova_api_front
    mode http
    http-request del-header X-Forwarded-Proto
    option httplog
    option forwardfor
    http-request set-header X-Forwarded-Proto https if { ssl_fc }
    bind 192.168.3.14:8774 ssl crt /etc/haproxy/certificates/haproxy-internal.pem alpn h2,http/1.1
    default_backend nova_api_back

backend nova_api_back
    mode http
    server infra1 192.168.3.10:8774 check check-ssl inter 2000 rise 2 fall 5 ssl verify required ca-file ca-certificates.crt 
    server infra2 192.168.3.11:8774 check check-ssl inter 2000 rise 2 fall 5 ssl verify required ca-file ca-certificates.crt 
    server infra3 192.168.3.12:8774 check check-ssl inter 2000 rise 2 fall 5 ssl verify required ca-file ca-certificates.crt 

frontend nova_api_external_front
    mode http
    http-request deny if { path -i -m beg /server-status }
    http-request del-header X-Forwarded-Proto
    option httplog
    option forwardfor
    http-request set-header X-Forwarded-Proto https if { ssl_fc }
    bind 192.168.3.13:8774 ssl crt /etc/haproxy/certificates/haproxy.pem alpn h2,http/1.1
    default_backend nova_api_external_back

backend nova_api_external_back
    mode http
    server infra1 192.168.3.10:8774 check check-ssl inter 2000 rise 2 fall 5 ssl verify required ca-file ca-certificates.crt 
    server infra2 192.168.3.11:8774 check check-ssl inter 2000 rise 2 fall 5 ssl verify required ca-file ca-certificates.crt 
    server infra3 192.168.3.12:8774 check check-ssl inter 2000 rise 2 fall 5 ssl verify required ca-file ca-certificates.crt 

frontend nova_metadata_front
    mode http
    http-request del-header X-Forwarded-Proto
    option httplog
    option forwardfor
    http-request set-header X-Forwarded-Proto https if { ssl_fc }
    bind 192.168.3.14:8775 ssl crt /etc/haproxy/certificates/haproxy-internal.pem alpn h2,http/1.1
    default_backend nova_metadata_back

backend nova_metadata_back
    mode http
    server infra1 192.168.3.10:8775 check check-ssl inter 2000 rise 2 fall 5 ssl verify required ca-file ca-certificates.crt 
    server infra2 192.168.3.11:8775 check check-ssl inter 2000 rise 2 fall 5 ssl verify required ca-file ca-certificates.crt 
    server infra3 192.168.3.12:8775 check check-ssl inter 2000 rise 2 fall 5 ssl verify required ca-file ca-certificates.crt 

